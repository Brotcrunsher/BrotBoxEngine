add_subdirectory(BBE)

file(GLOB local_src CONFIGURE_DEPENDS "*.cpp")
target_sources(BrotBoxEngine PRIVATE "${local_src}")

target_include_directories(BrotBoxEngine PUBLIC .)

set(outputCpp "#include \"BBE/List.h\"\n#include \"EmbedOutput.h\"\n\n")
set(outputH "#include \"BBE/List.h\"\n\n")
foreach(filename frag2DImage;frag2DPrimitive;frag3DPrimitive;frag3DTerrain;tesc3DTerrain;tese3DTerrain;vert2DPrimitive;vert3DPrimitive;vert3DTerrain)
  file(READ ${filename}.spv contents HEX)
  string(APPEND outputH "extern const bbe::List<unsigned char> ${filename}\;\n")
  string(APPEND outputCpp "const bbe::List<unsigned char> ${filename} = { ")
  while(true)
    string(SUBSTRING ${contents} 0 2 hex)
    string(SUBSTRING ${contents} 2 -1 contents)
    string(APPEND outputCpp "0x")
    string(APPEND outputCpp ${hex})
    if(NOT contents)
      break()
    endif()
    string(APPEND outputCpp ",")
  endwhile()
  string(APPEND outputCpp " }\;\n")
endforeach()

file(WRITE EmbedOutput.h ${outputH})
file(WRITE EmbedOutput.cpp ${outputCpp})
